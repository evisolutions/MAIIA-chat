<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAIIA Chat Widget Test</title>

    <!-- Vue -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- Vue Demi -->
    <script src="https://unpkg.com/vue-demi@0.14.7/lib/index.iife.js"></script>

    <!-- Pinia -->
    <script src="https://unpkg.com/pinia@2.1.7/dist/pinia.iife.prod.js"></script>

    <!-- Vuetify -->
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.9/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.9/dist/vuetify.min.js"></script>

    <!-- Material Design Icons -->
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://websiteaddon.maiiaconcierge.ai/style.css" />

    <!-- Configuration - These values would come from WordPress settings in the plugin -->
    <script>
        window.MaiiaConfig = {
            domain: 'https://websiteaddon.maiiaconcierge.ai',
            // domain: "./dist",
            propertyId: "13",
            conversationType: "maiia",
            zIndex: "9999",
            theme: "light",
        };
    </script>

    <!-- Widget Styles & Script -->
    <script>
        // document.write(
        //   '<link rel="stylesheet" href="' +
        //     window.MaiiaConfig.domain +
        //     '/style.css">'
        // );
        document.write(
            '<script src="' +
            window.MaiiaConfig.domain +
            '/maiia-widget.umd.js"><\/script>'
        );
    </script>
</head>

<body>
    <!-- Widget Container -->
    <div id="app"></div>

    <!-- Widget Initialization -->
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            console.log("DOM loaded, checking for widget dependencies...");

            const checkDependencies = setInterval(() => {
                if (
                    window.Vue &&
                    window.VueDemi &&
                    window.Pinia &&
                    window.Vuetify &&
                    window.MaiiaWidget
                ) {
                    clearInterval(checkDependencies);
                    console.log("Dependencies loaded:", {
                        Vue: window.Vue.version,
                        VueDemi: !!window.VueDemi,
                        Pinia: !!window.Pinia,
                        Vuetify: !!window.Vuetify,
                        MaiiaWidget: !!window.MaiiaWidget,
                    });

                    try {
                        // Initialize widget with configuration
                        const widget = window.MaiiaWidget.init("app", {
                            theme: window.MaiiaConfig.theme,
                            propertyId: window.MaiiaConfig.propertyId,
                            conversationType: window.MaiiaConfig.conversationType,
                            zIndex: window.MaiiaConfig.zIndex,
                        });
                        console.log("Widget initialized successfully");
                    } catch (error) {
                        console.error("Widget initialization error:", error);
                    }
                } else {
                    console.log("Waiting for dependencies...");
                }
            }, 100);

            // Timeout after 5 seconds
            setTimeout(() => {
                clearInterval(checkDependencies);
                console.error("Timeout waiting for dependencies");
            }, 5000);
        });
    </script>

    <!-- For testing, you can add a page content example -->
    <div style="padding: 20px; max-width: 800px; margin: 0 auto">
        <h1>MAIIA Chat Widget Test Page</h1>
        <p>This is a standalone test page for the MAIIA Chat Widget.</p>
        <p>The widget should appear in the bottom right corner.</p>
        <p>
            You can modify the configuration values in the MaiiaConfig object at the
            top of this file.
        </p>

        <h2>Current Configuration:</h2>
        <pre id="config-display"></pre>

        <script>
            document.getElementById("config-display").textContent = JSON.stringify(
                window.MaiiaConfig,
                null,
                2
            );
        </script>
    </div>
</body>

</html>
